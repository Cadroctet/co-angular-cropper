!function(e,t){"use strict";function n(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1}var a=e.module("co-angular-cropper",[]);String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.lcfirst=function(){return this.charAt(0).toLowerCase()+this.slice(1)},a.constant("CroppableDefaults",{aspectRatio:0,ruleOfThirds:!0,outputType:"base64",widthMin:50,widthMax:0,heightMin:50,heightMax:0,autoCropping:!0,imageType:"jpeg",centerHandles:!0,sizeHint:!0,loadingClass:"cropper-loading",backdropOpacity:50,eventPrefix:"crop",optionsPrefix:"crop",directiveName:"$croppable",preloader:!0}),a.controller("CroppableController",["$scope","$element","$attrs","$compile","$parse","$q","$log","$window","$document","$timeout","$interpolate","CroppableDefaults",function(a,i,o,s,r,h,c,m,l,d,p,$){function f(t){return e.isDefined(oe.$cropper)&&(L(),X(),F(),oe.$hasSelection=k(),B(t),v(),w(),B("onUpdate")),oe}function u(){re.imgSrc=o.ngSrc,i.wrap('<div class="crop-it-container"></div>'),oe.$cropContainer=i.parent().prepend(g()),oe.$cropper=e.element(oe.$cropContainer[0].querySelector(".cropper")),oe.$cropArea=e.element(oe.$cropper[0].querySelector(".crop-area")),oe.$overlayedImg=e.element(oe.$cropArea[0].querySelector("img")),oe.$cropHandles=e.element(oe.$cropper[0].querySelector(".crop-handles")),oe.$centerHandles=e.element(oe.$cropHandles[0].querySelectorAll(".center-handle")),oe.$sizeHint=e.element(oe.$cropper[0].querySelector(".size-hint")),oe.$ruleOfThirds=e.element(oe.$cropArea[0].querySelectorAll(".rule-of-thirds"))}function g(){var t="";return t+='<span ng-if="options.preloader" class="crop-loader"><span class="crop-loader-inner"></span></span>',t+='<div class="cropper" style="display: none;">',t+='<div class="crop-area">',t+='<img ng-src="{{ imgSrc }}">',t+='<span class="rule-of-thirds vertical-1"></span>',t+='<span class="rule-of-thirds vertical-2"></span>',t+='<span class="rule-of-thirds horizontal-1"></span>',t+='<span class="rule-of-thirds horizontal-2"></span>',t+="</div>",t+='<div class="crop-handles">',t+='<div class="handle top-left"></div>',t+='<div class="handle center-handle top"></div>',t+='<div class="handle top-right"></div>',t+='<div class="handle center-handle right"></div>',t+='<div class="handle bottom-right"></div>',t+='<div class="handle center-handle bottom"></div>',t+='<div class="handle bottom-left"></div>',t+='<div class="handle center-handle left"></div>',t+="</div>",t+='<span class="size-hint"></span>',t+="</div>",t=e.element(t),re.options=te,s(t)(re)}function v(){oe.$cropper.css({display:oe.$active&&oe.$hasSelection?"block":"none",top:oe.$measurements.top+"px",left:oe.$measurements.left+"px",width:oe.$measurements.width+"px",height:oe.$measurements.height+"px"}),oe.$overlayedImg.css({width:i[0].offsetWidth+"px",height:i[0].offsetHeight+"px",top:"-"+oe.$measurements.top+"px",left:"-"+oe.$measurements.left+"px"}),i.css({opacity:oe.$active&&oe.$hasSelection?te.backdropOpacity/100:"1"}),oe.$sizeHint.text(Math.round(oe.$data.width)+"x"+Math.round(oe.$data.height)).css({opacity:te.sizeHint&&oe.$selecting&&oe.$hasSelection?1:0}),oe.$ruleOfThirds.css({display:te.ruleOfThirds&&oe.$hasSelection?"block":"none"})}function w(){oe.$cropHandles.css({display:oe.$hasSelection&&!oe.$selecting&&!oe.$moving&&oe.$active?"block":"none"}),oe.$centerHandles.css({display:te.centerHandles?"block":"none"})}function b(n){i.off("$destroy",b),e.isDefined(n)&&e.isDefined(oe.$name)&&delete r(te.directiveName)(a)[oe.$name],e.isDefined(oe.$cropContainer)&&(P(!0),e.isUndefined(o.ngSrc)&&e.isUndefined(n)&&(i.removeAttr("src"),i.attr("ng-src",oe.$srcAttr)),oe.$cropContainer.replaceWith(i),oe.$cropContainer=t,oe.$cropper=t,oe.$cropArea=t,oe.$cropHandles=t,oe.$overlayedImg=t,oe.$centerHandles=t,oe.$sizeHint=t,oe.$ruleOfThirds=t),e.forEach(de,function(e){e()}),y(),S(),le||(D(),me=oe.$initialized=!1),oe.$data.base64=null,B("onDestroy")}function x(){ne=a.$watch(o.croppable,function(t,n){t!==n&&e.isDefined(t)&&!le&&(e.isObject(t)?(t.width&&n.width&&t.width!==n.width?he=!0:t.height&&n.height&&t.height!==n.height&&(ce=!0),oe.$data.top=t.top||oe.$data.top,oe.$data.left=t.left||oe.$data.left,oe.$data.width=t.width||oe.$data.width,oe.$data.height=t.height||oe.$data.height,j(),f(),he=!1,ce=!1):c.warn("The new value in the "+(o.croppable+" variable "||"croppable attribute ")+"is not an object!"))},!0)}function y(){return e.isUndefined(ne)?!1:(ne(),ne=t,!0)}function M(){ae=a.$watch(o[te.optionsPrefix+"Options"],function(t,n){t!==n&&e.isDefined(t)?K(t):t!==n&&e.isUndefined(t)&&K($)},!0)}function S(){return e.isUndefined(ae)?!1:(ae(),ae=t,!0)}function R(){x(),o.hasOwnProperty(te.optionsPrefix+"Show")&&q(o[te.optionsPrefix+"Show"],function(e,t){e===t||"boolean"!=typeof e||e===t||le||(e===!1?P():I())}),o.hasOwnProperty(te.optionsPrefix+"Options")&&M(),q(function(){return oe.$loading},function(t,n){t!==n&&e.isDefined(oe.$cropContainer)&&te.preloader&&oe.$cropContainer.toggleClass(te.loadingClass,t)})}function C(){ie=o.$observe("ngSrc",function(t){if(me){if(le=!0,e.isUndefined(t))return b(),void(le=!1);e.isUndefined(ne)&&(K(a.$eval(o[te.optionsPrefix+"Options"])),R()),P(!0),re.imgSrc=t,J().then(function(){Z(e.isUndefined(a.$eval(o.croppable))?{width:0,height:0,left:0,top:0}:e.extend({},oe.$data,a.$eval(o.croppable))),le=!1,I()})}})}function D(){return e.isUndefined(ie)?!1:(ie(),ie=t,!0)}function I(){if(oe.$active===!1&&e.isDefined(o.ngSrc)){if(e.isDefined(o[te.optionsPrefix+"Show"])&&!!a.$eval(o[te.optionsPrefix+"Show"])==!1)return oe;e.isUndefined(oe.$cropContainer)&&u(),oe.$active=!0,oe.$cropContainer.on("touchstart mousedown",H).addClass("crop-active"),oe.$cropHandles.children().on("touchstart mousedown",A),oe.$cropper.on("touchstart mousedown",z),e.element(m).on("resize",E),o.hasOwnProperty(te.optionsPrefix+"Show")&&r(o[te.optionsPrefix+"Show"]).assign(a,!0),f("onEnable")}return oe}function P(t){return oe.$active===!0&&(oe.$active=!1,oe.$cropContainer.off("touchstart mousedown",H).removeClass("crop-active"),oe.$cropHandles.children().off("touchstart mousedown",A),oe.$cropper.off("touchstart mousedown",z),e.element(m).off("resize",E),o.hasOwnProperty(te.optionsPrefix+"Show")&&t!==!0&&r(o[te.optionsPrefix+"Show"]).assign(a,!1),f("onDisable")),oe}function H(t){2!==t.button&&(t.preventDefault(),e.element(m).on("touchend mouseup",T),e.element(m).on("touchmove mousemove",O),_=N(t),oe.$selecting=!0,oe.$measurements.top=0,oe.$measurements.left=0,oe.$measurements.width=0,oe.$measurements.height=0,oe.$data.base64=null,f("onSelectStart"))}function O(e){if(oe.$selecting){e.preventDefault(),ee=N(e);var t=ee.x-_.x,n=ee.y-_.y;te.aspectRatio&&he?(n=n>0?Math.min(i[0].offsetHeight-_.y,Math.abs(Math.round(t/te.aspectRatio))):Math.min(_.y,Math.abs(Math.round(t/te.aspectRatio))),t=n*te.aspectRatio):te.aspectRatio&&ce&&(t=t>0?Math.min(i[0].offsetWidth-_.x,Math.abs(n*te.aspectRatio)):Math.min(_.x,Math.abs(n*te.aspectRatio)),n=t/te.aspectRatio),oe.$measurements.left=ee.x-_.x>0||!he?_.x:Math.max(0,_.x-Math.abs(t)),oe.$measurements.top=ee.y-_.y>0||!ce?_.y:Math.max(0,_.y-Math.abs(n)),te.aspectRatio||he&&ce?(oe.$measurements.width=Math.abs(t),oe.$measurements.height=Math.abs(n)):he?oe.$measurements.width=Math.abs(t):ce&&(oe.$measurements.height=Math.abs(n)),f("onSelect")}}function T(n){n.stopPropagation(),he=!0,ce=!0,e.element(m).off("touchend mouseup",T),oe.$moving?(e.element(m).off("touchmove mousemove",U),oe.$moving=!1,f("onMoveEnd")):oe.$selecting&&(e.element(m).off("touchmove mousemove",O),oe.$selecting=!1,f("onSelectEnd"),ee=t)}function z(t){if(2!==t.button&&(t.stopPropagation(),t.preventDefault(),!oe.$moving)){e.element(m).on("touchmove mousemove",U),e.element(m).on("touchend mouseup",T);var n=N(t);oe.$moving=!0,se.posX=n.x-oe.$cropper[0].offsetLeft,se.posY=n.y-oe.$cropper[0].offsetTop,f("onMoveStart")}}function U(e){oe.$data.base64=null;var t=N(e);oe.$measurements.left=Math.max(0,Math.min(t.x-se.posX,i[0].offsetWidth-oe.$cropper[0].offsetWidth)),oe.$measurements.top=Math.max(0,Math.min(t.y-se.posY,i[0].offsetHeight-oe.$cropper[0].offsetHeight)),f("onMove")}function A(t){if(2!==t.button){t.preventDefault(),t.stopPropagation();var n=e.element(t.target);oe.$selecting=!0,n.hasClass("top-left")?(_.x=oe.$measurements.left+oe.$measurements.width,_.y=oe.$measurements.top+oe.$measurements.height):n.hasClass("top")?(he=!1,_.x=oe.$measurements.left,_.y=oe.$measurements.top+oe.$measurements.height):n.hasClass("top-right")?(_.x=oe.$measurements.left,_.y=oe.$measurements.top+oe.$measurements.height):n.hasClass("right")?(ce=!1,_.x=oe.$measurements.left,_.y=oe.$measurements.top):n.hasClass("bottom-right")?(_.x=oe.$measurements.left,_.y=oe.$measurements.top):n.hasClass("bottom")?(he=!1,_.x=oe.$measurements.left,_.y=oe.$measurements.top):n.hasClass("bottom-left")?(_.x=oe.$measurements.left+oe.$measurements.width,_.y=oe.$measurements.top):n.hasClass("left")&&(ce=!1,_.x=oe.$measurements.left+oe.$measurements.width,_.y=oe.$measurements.top),e.element(m).on("touchmove mousemove",O),e.element(m).on("touchend mouseup",T)}}function E(){j(),f()}function W(e){var t=e[0].getBoundingClientRect();return{top:t.top+m.pageYOffset-l[0].documentElement.clientTop,left:t.left+m.pageXOffset-l[0].documentElement.clientLeft}}function N(e){var t=e.touches&&e.touches.length?e.touches:[e],n=e.changedTouches&&e.changedTouches[0]||e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]||t[0].originalEvent||t[0],a=W(i),o=n.pageX-a.left,s=n.pageY-a.top;return{x:Math.max(0,Math.min(o,i[0].offsetWidth)),y:Math.max(0,Math.min(s,i[0].offsetHeight))}}function k(){return oe.$measurements.width>0||oe.$measurements.height>0}function q(e,t,n){var i=a.$watch(e,t,n||!1);de.push(i)}function L(){oe.$imgInfo.scaleRatio=Math.min(oe.$imgInfo.originalWidth/i[0].offsetWidth,oe.$imgInfo.originalHeight/i[0].offsetHeight),oe.$data.top=oe.$measurements.top*oe.$imgInfo.scaleRatio,oe.$data.left=oe.$measurements.left*oe.$imgInfo.scaleRatio,oe.$data.width=oe.$measurements.width*oe.$imgInfo.scaleRatio,oe.$data.height=oe.$measurements.height*oe.$imgInfo.scaleRatio}function j(){oe.$imgInfo.scaleRatio=Math.min(oe.$imgInfo.originalWidth/i[0].offsetWidth,oe.$imgInfo.originalHeight/i[0].offsetHeight),oe.$measurements.top=oe.$data.top/oe.$imgInfo.scaleRatio,oe.$measurements.left=oe.$data.left/oe.$imgInfo.scaleRatio,oe.$measurements.width=oe.$data.width/oe.$imgInfo.scaleRatio,oe.$measurements.height=oe.$data.height/oe.$imgInfo.scaleRatio}function X(){var e,n,a=te.heightMax?te.heightMax/oe.$imgInfo.scaleRatio:t,o=te.widthMax?te.widthMax/oe.$imgInfo.scaleRatio:t,s=te.heightMin?te.heightMin/oe.$imgInfo.scaleRatio:t,r=te.widthMin?te.widthMin/oe.$imgInfo.scaleRatio:t;k()&&(te.aspectRatio&&he?oe.$measurements.height=oe.$measurements.width/te.aspectRatio:te.aspectRatio&&ce&&(oe.$measurements.width=oe.$measurements.height*te.aspectRatio),o&&oe.$measurements.width>o&&o>r&&!oe.$moving&&(oe.$measurements.width=o,oe.$measurements.height=te.aspectRatio?a:oe.$measurements.height,oe.$measurements.top=ee&&ee.y-_.y<0?_.y-oe.$measurements.height:oe.$measurements.top,oe.$measurements.left=ee&&ee.x-_.x<0?_.x-oe.$measurements.width:oe.$measurements.left),a&&oe.$measurements.height>a&&a>s&&!oe.$moving&&(oe.$measurements.height=a,oe.$measurements.width=te.aspectRatio?o:oe.$measurements.width,oe.$measurements.top=ee&&ee.y-_.y<0?_.y-oe.$measurements.height:oe.$measurements.top),!oe.$selecting&&r&&oe.$measurements.width<r&&(oe.$measurements.width=r,oe.$measurements.height=te.aspectRatio?s:oe.$measurements.height),!oe.$selecting&&s&&oe.$measurements.height<s&&(oe.$measurements.height=s,oe.$measurements.width=te.aspectRatio?r:oe.$measurements.width),n=i[0].offsetWidth-(oe.$measurements.left+oe.$measurements.width),e=i[0].offsetHeight-(oe.$measurements.top+oe.$measurements.height),0>n&&(oe.$measurements.width=oe.$measurements.left+n<0?i[0].offsetWidth:oe.$measurements.width,oe.$measurements.left=oe.$measurements.left+n<0?0:oe.$measurements.left+n),0>e&&(oe.$measurements.height=oe.$measurements.top+e<0?i[0].offsetHeight:oe.$measurements.height,oe.$measurements.top=oe.$measurements.top+e<0?0:oe.$measurements.top+e),L())}function Y(){te.aspectRatio&&te.widthMax?te.heightMax=te.widthMax/te.aspectRatio:te.aspectRatio&&te.heightMax&&(te.widthMax=te.heightMax*te.aspectRatio),te.aspectRatio&&te.widthMin?te.heightMin=te.widthMin/te.aspectRatio:te.aspectRatio&&te.heightMin&&(te.widthMin=te.heightMin*te.aspectRatio),d(function(){var e=S();r(o[te.optionsPrefix+"Options"]).assign(a,te),e&&M()})}function B(i){var s=e.isString(i)?i:t;return e.isUndefined(s)||n(pe,s)===!1?!1:void d(function(){var e=null!==i.match(/\^?before/)&&"before"===i.match(/\^?before/)[0]?i:i.replace(/\^?on/,"").lcfirst();oe[s](),a.$emit(te.eventPrefix+"."+e,oe.$data,oe,a.$eval(o.cropData))},0)}function G(){d(function(){var e={width:Math.round(oe.$data.width),height:Math.round(oe.$data.height),top:Math.round(oe.$data.top),left:Math.round(oe.$data.left),base64:oe.$data.base64};y(),r(o.croppable).assign(a,e),me&&x()})}function F(){var e,t;if(!le)if(oe.$selecting||oe.$moving||!k())G();else if(te.autoCropping){e=l[0].createElement("canvas"),e.width=oe.$data.width,e.height=oe.$data.height,t=e.getContext("2d"),t.drawImage(i[0],oe.$data.left,oe.$data.top,oe.$data.width,oe.$data.height,0,0,oe.$data.width,oe.$data.height);try{oe.$data.base64=e.toDataURL("image/"+te.imageType)}catch(n){c.error(n.message)}finally{return G(),oe.$data.base64}}}function J(){B("beforeImageLoad"),oe.$loading=!0;var e=h.defer(),t=new Image;return t.onload=function(){oe.$data.base64=null,oe.$imgInfo.originalWidth=t.width,oe.$imgInfo.originalHeight=t.height,e.resolve(),oe.$loading=!1,B("onImageLoad")},t.src=o.ngSrc,e.promise}function K(t,n){if(t=t||$,e.isObject(t))te=e.extend({},$,t);else if(e.isDefined(n)&&e.isString(t))te[t]=n;else if(e.isString(t)&&e.isUndefined(n))return te[t];return Y(),le||f(),oe}function Q(){e.forEach(pe,function(t){e.isDefined(o[te.optionsPrefix+t.ucfirst()])?oe[t]=function(){a.$eval(o[te.optionsPrefix+t.ucfirst()],{$data:oe.$data,$croppable:oe})}:oe[t]=e.noop})}function V(){return k()&&(oe.$data={top:0,left:0,width:0,height:0,base64:null},j(),f("onReset")),oe}function Z(t,n){return e.isUndefined(t)?oe:(e.isArray(t)?(oe.$data.top=e.isDefined(t[0])&&e.isNumber(t[0])?t[0]:oe.$data.top,oe.$data.left=e.isDefined(t[1])&&e.isNumber(t[1])?t[1]:oe.$data.left,oe.$data.width=e.isDefined(t[2])&&e.isNumber(t[2])?t[2]:oe.$data.width,oe.$data.height=e.isDefined(t[3])&&e.isNumber(t[3])?t[3]:oe.$data.height):e.isObject(t)?oe.$data=e.extend({},oe.$data,t):e.isString(t)&&e.isNumber(n)&&(oe.$data[t]=n),j(),_={x:oe.$measurements.left,y:oe.$measurements.top},X(),oe)}var _,ee,te,ne,ae,ie,oe=this,se={},re=a.$new(!0),he=!0,ce=!0,me=!1,le=!1,de=[],pe=["onSelectStart","onSelect","onSelectEnd","onMoveStart","onMove","onMoveEnd","onEnable","onDisable","onReset","onUpdate","onDestroy","onReady","beforeImageLoad","onImageLoad"];oe.$name,oe.$selecting=!1,oe.$moving=!1,oe.$loading=!1,oe.$measurements={top:0,left:0,width:0,height:0},oe.$data={top:0,left:0,width:0,height:0,base64:null},oe.$imgInfo={},oe.$active=!1,oe.$hasSelection=!1,oe.$initialized=!1,oe.$cropContainer,oe.$cropper,oe.$cropArea,oe.$overlayedImg,oe.$cropHandles,oe.$centerHandles,oe.$sizeHint,oe.$ruleOfThirds,i.on("$destroy",b),oe.$options=K,oe.$clear=V,oe.$toggle=function(){return oe.$active?oe.disableCrop():oe.enableCrop()},oe.$cropIt=function(t,n){return e.isDefined(t)?void oe.setArea(t,n):oe.makeCropData()},oe.$destroy=function(){return b(),oe},oe.$init=function(t){return me?void c.info("The cropper has already been initialized!"):(K(t),Q(),e.isDefined(o.ngSrc)?J().then(function(){Z(a.$eval(o.croppable)),I(),R(),C(),B("onReady"),d(function(){me=oe.$initialized=!0})}):(C(),d(function(){me=oe.$initialized=!0})),oe)}}]),a.directive("croppable",["$parse","$interpolate","CroppableDefaults",function(t,n,a){return{restict:"A",priority:100,controller:"CroppableController",link:{pre:function(e,t,n,a){a.$srcAttr=n.ngSrc},post:function(i,o,s,r){if("IMG"!==o[0].tagName)throw"The croppable element must be an image tag!";if(!s.hasOwnProperty("ngSrc")&&!s.hasOwnProperty("src"))throw"The image tag has no ngSrc or src attribute, croppable directive can't function without this";var h={};s.hasOwnProperty("cropOptions")&&e.isDefined(s.cropOptions)&&e.isObject(i.$eval(s.cropOptions))&&(h=e.extend(h,i.$eval(s.cropOptions)));for(var c in a)e.isDefined(i.$eval(s[a.optionsPrefix+c.ucfirst()]))&&(h[c]=i.$eval(s[a.optionsPrefix+c.ucfirst()]));r.$init(h),s.hasOwnProperty(r.$options("optionsPrefix")+"Name")&&e.isString(s[r.$options("optionsPrefix")+"Name"])&&(r.$name=n(s[r.$options("optionsPrefix")+"Name"])(i),t(a.directiveName+"."+r.$name).assign(i,r))}}}}])}(window.angular);